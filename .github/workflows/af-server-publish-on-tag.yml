name: AF Server - Build & Publish on Version Tag

on:
  push:
    tags:
      - 'v*'
    paths:
      - "AssetsFlow.Server/**"
  workflow_dispatch:

jobs:
  build-and-publish:
    runs-on: ubuntu-latest
    env: 
      UPABASE_DB_ID: ${{ secrets.SUPABASE_DB_ID }}
      SUPABASE_DB_PASS: ${{ secrets.SUPABASE_DB_PASS }}
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
        
      - name: Run Dotnet Build & Publish Action
        uses: ./.github/actions/dotnet-publish-common
        with:
          project-path: ./AssetsFlow.Server/AssetsFlow.Web.API
          image-name: assetsflow-backend
          github-token: ${{ secrets.GITHUB_TOKEN }}
